# 测试用例 - 数据源分组功能

## 测试环境
- Obsidian版本：最新版
- TrendRadar插件版本：v1.1.0
- 测试vault：test

## 测试场景

### 场景1：查看分组列表

**前置条件**：
- 已安装并启用TrendRadar插件
- 后端API正常运行

**测试步骤**：
1. 打开Obsidian设置
2. 点击"TrendRadar"
3. 点击"数据源分组"Tab

**预期结果**：
- ✅ 看到"数据源分组"Tab（位于"常规设置"和"数据源管理"之间）
- ✅ 显示分组列表（如果有分组）
- ✅ 看到"+ 添加分组"按钮

**实际结果**：待测试

---

### 场景2：创建新分组（带AI配置）

**前置条件**：
- 已打开分组管理界面

**测试步骤**：
1. 点击"+ 添加分组"按钮
2. 填写分组ID：`test-group`
3. 填写分组名称：`测试分组`
4. 填写描述：`用于测试的分组`
5. 启用分组：✓
6. 启用AI配置：✓
7. 选择AI提供商：`OpenAI`
8. 填写API Key
9. 选择模型：`gpt-4o-mini`
10. 设置温度：0.7
11. 点击"保存"

**预期结果**：
- ✅ 表单验证通过
- ✅ 分组创建成功
- ✅ 显示成功提示
- ✅ 分组出现在列表中

**实际结果**：待测试

---

### 场景3：在分组中添加现有数据源

**前置条件**：
- 已创建分组
- 已有至少一个数据源

**测试步骤**：
1. 编辑分组
2. 滚动到"数据源管理"部分
3. 点击"+ 添加数据源"按钮
4. 选择一个数据源
5. 点击"添加"

**预期结果**：
- ✅ 显示可用数据源列表
- ✅ 数据源添加到分组
- ✅ 分组的数据源列表更新
- ✅ 显示成功提示

**实际结果**：待测试

---

### 场景4：在分组中创建本地数据源

**前置条件**：
- 已创建分组

**测试步骤**：
1. 编辑分组
2. 滚动到"数据源管理"部分
3. 点击"创建数据源"按钮
4. 选择类型：`本地目录`
5. 填写名称：`测试文档`
6. 填写目录路径：`/Users/apple/Library/Mobile Documents/iCloud~md~obsidian/Documents/test`
7. 填写文件模式：`*.md, *.txt`
8. 启用递归：✓
9. 点击"创建"

**预期结果**：
- ✅ 数据源创建成功
- ✅ 数据源自动添加到分组
- ✅ 显示成功提示
- ✅ 分组的数据源列表更新

**实际结果**：待测试

---

### 场景5：从分组中移除数据源

**前置条件**：
- 分组中已有数据源

**测试步骤**：
1. 编辑分组
2. 在数据源列表中找到要移除的数据源
3. 点击"×"按钮

**预期结果**：
- ✅ 数据源从分组中移除
- ✅ 界面刷新
- ✅ 数据源本身未被删除（只是从分组移除）

**实际结果**：待测试

---

### 场景6：编辑分组AI配置

**前置条件**：
- 已创建带AI配置的分组

**测试步骤**：
1. 编辑分组
2. 修改AI提供商
3. 修改API地址
4. 修改模型名称
5. 调整温度参数
6. 点击"保存"

**预期结果**：
- ✅ 配置更新成功
- ✅ 显示成功提示

**实际结果**：待测试

---

### 场景7：删除分组

**前置条件**：
- 已创建分组

**测试步骤**：
1. 在分组列表中找到要删除的分组
2. 点击删除按钮（垃圾桶图标）
3. 确认删除

**预期结果**：
- ✅ 显示确认对话框
- ✅ 分组删除成功
- ✅ 分组从列表中消失
- ✅ 数据源本身未被删除

**实际结果**：待测试

---

### 场景8：表单验证

**子场景8.1：缺少必填字段**
**测试步骤**：
1. 创建分组时，不填写分组ID
2. 点击"保存"

**预期结果**：
- ✅ 显示错误提示："请填写分组ID和名称"
- ✅ 无法保存

**实际结果**：待测试

**子场景8.2：ID格式验证**
**测试步骤**：
1. 创建分组时，填写分组ID为：`Test Group`（包含大写和空格）
2. 点击"保存"

**预期结果**：
- ✅ 显示错误提示："分组ID只能包含小写字母、数字和连字符"
- ✅ 无法保存

**实际结果**：待测试

---

### 场景9：错误处理

**子场景9.1：API连接失败**
**前置条件**：
- 后端API未运行

**测试步骤**：
1. 尝试创建分组

**预期结果**：
- ✅ 显示友好的错误提示
- ✅ 不会崩溃或卡死

**实际结果**：待测试

**子场景9.2：创建数据源失败**
**前置条件**：
- 后端API返回错误

**测试步骤**：
1. 在分组中创建数据源
2. 填写无效数据

**预期结果**：
- ✅ 显示错误提示
- ✅ Modal不会关闭
- ✅ 可以重新尝试

**实际结果**：待测试

---

### 场景10：本地数据源功能

**前置条件**：
- 已创建本地数据源

**测试步骤**：
1. 确保测试vault中有一些Markdown文件
2. 创建本地数据源指向测试vault
3. 保存并触发抓取
4. 查看结果

**预期结果**：
- ✅ 成功读取本地文件
- ✅ 正确提取标题
- ✅ 内容正确索引
- ✅ 文件修改时间正确

**实际结果**：待测试

---

## 边界条件测试

### 边界1：分组ID长度
- 测试超长分组ID（>100字符）
- 测试空分组ID
- 测试特殊字符

### 边界2：大量数据源
- 测试分组包含50+数据源
- 测试同时管理10+分组

### 边界3：特殊路径
- 测试包含中文的路径
- 测试包含空格的路径
- 测试嵌套很深的路径

## 性能测试

### 性能1：加载时间
- 测试分组列表加载时间（<1秒）
- 测试数据源选择器加载时间（<2秒）

### 性能2：响应时间
- 测试创建分组响应时间（<3秒）
- 测试添加数据源响应时间（<2秒）

## 兼容性测试

- macOS系统
- Windows系统
- Linux系统

## 自测结果

**当前状态**：⏳ 待进行

**自测计划**：
1. 重启Obsidian，确保插件重新加载
2. 依次执行上述10个主要场景
3. 记录实际结果和发现的问题
4. 修复发现的问题
5. 重新测试

**自测日期**：2026-01-10

**测试人员**：Claude (AI助手)
