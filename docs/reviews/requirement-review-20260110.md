# TrendRadar 数据源分组功能 - 需求评审文档

## 评审日期
2026-01-10

## 评审人员
Claude (AI 助手)

## 需求概述

### 原始需求
1. **抓取失败内容处理**：对于只获取到标题而无法全文抓取失败的内容，不参与AI分析，最后直接汇聚生成一个统一的卡片展示链接即可
2. **可扩展的数据源架构**：支持将网络源（RSS、Web、Twitter）和本地文件源混合分析，每个分组可以使用不同的AI配置

### 用户强调的需求
1. **前端配置优先**：凡是业务相关、用户使用过程中会修改的配置，都应由用户通过前端配置，而非手动编辑配置文件
2. **分阶段AI处理**：在分析阶段和聚合阶段所采用的模型服务可能不一样
3. **工作流程要求**：每次编码修改后要进行需求评审、代码评审、撰写changelog、测试用例，并进行自测

## 需求分析

### 1. 抓取失败内容处理 ✅

**需求理解**：
- 当全文抓取失败时，只保留标题和URL
- 不参与AI分析
- 最终生成统一的"链接汇总"卡片

**实现状态**：
- ✅ 已在现有代码中实现（`trendradar/storage/local.py:1154-1167`）
- ✅ 自动标记 `needs_link_card = 1`
- ✅ 内容质量检查（`_is_content_invalid`）
- ✅ 生成汇总卡片（`trendradar/core/ai_analyzer.py:340-472`）

**评审结论**：✅ 需求已正确实现，无需修改

### 2. 数据源分组架构 ⚠️

**需求理解**：
- 支持多个数据源分组
- 每个分组可以有独立的AI配置
- 支持本地文件数据源
- 网络源和本地源可以混合分析
- 分阶段AI处理（分析阶段和聚合阶段可能使用不同模型）

**当前实现**：
- ✅ 后端API完整实现
- ✅ 分组管理器（`SourceGroupManager`）
- ✅ 本地数据源（`LocalSource`）
- ✅ 分组分析器（`GroupAnalyzer`）
- ✅ 前端UI（分组管理Tab）
- ✅ API接口完整

**发现的问题**：

#### 问题1：分组与数据源无法关联 ❌
**严重程度**：严重

**问题描述**：
- 在"数据源分组"Tab中创建分组后，无法为分组添加数据源
- "数据源管理"Tab中的数据源无法选择所属分组
- 分组编辑Modal中只显示"请在数据源管理Tab中管理"，但数据源管理界面没有分组选择功能

**影响**：
- 用户无法完成核心功能：将数据源组织到分组中
- 分组功能形同虚设
- 无法实现按分组的AI分析和处理

**根本原因**：
设计时将分组管理和数据源管理完全分离，没有设计关联机制

**解决方案**：
1. 在分组编辑Modal中直接管理数据源（添加现有数据源或创建新数据源）
2. 修改API以支持将数据源分配到分组

#### 问题2：分阶段AI处理不明确 ❓
**严重程度**：需要澄清

**问题描述**：
- 不清楚"分析阶段"和"聚合阶段"的具体定义
- 不清楚这两个阶段是否会在同一个分组中使用不同的AI模型
- 不清楚当前的`GroupAnalyzer`是否支持分阶段处理

**需要澄清的问题**：
1. "分析阶段"是指什么？是AI分析单篇文章吗？
2. "聚合阶段"是指什么？是将多篇文章聚合为主题吗？
3. 这两个阶段是否会使用不同的AI配置？
4. 是否需要为每个分组配置两个AI配置（一个用于分析，一个用于聚合）？

**当前实现状态**：
- `GroupAnalyzer` 只有一个 `ai_config`
- 没有区分分析阶段和聚合阶段

## 需求对比分析

### 需求 vs 实现对比表

| 需求项 | 期望 | 实际状态 | 差距 | 严重性 |
|--------|------|----------|------|--------|
| 抓取失败处理 | 不参与AI分析，生成链接卡片 | ✅ 已实现 | 无 | - |
| 数据源分组 | 支持多个分组 | ✅ 已实现 | 无 | - |
| 分组AI配置 | 每个分组独立的AI配置 | ✅ 已实现 | 无 | - |
| 本地数据源 | 支持本地目录 | ✅ 已实现 | 无 | - |
| **分组管理数据源** | 在分组中管理数据源 | ❌ 未实现 | 无法将数据源添加到分组 | 严重 |
| **分阶段AI处理** | 分析和聚合阶段可用不同模型 | ❓ 不明确 | 需求不明确 | 待澄清 |
| **前端配置** | 所有配置通过UI完成 | ⚠️ 部分实现 | 分组无法管理数据源 | 严重 |

## 需求评审结论

### 已正确实现的需求 ✅
1. 抓取失败内容的特殊处理
2. 数据源分组架构的基础设施
3. 本地数据源支持
4. 分组管理UI

### 严重问题 ❌
1. **分组与数据源无法关联** - 核心功能缺失
   - 影响：用户无法使用分组功能
   - 紧急程度：高
   - 需要立即修复

### 需要澄清的需求 ❓
1. **分阶段AI处理的具体含义**
   - 是否需要为每个分组配置两个AI配置？
   - 当前实现是否满足需求？

### 总体评估

**需求理解准确度**：70%
- 核心需求理解正确，但缺少分组-数据源关联机制
- 分阶段AI处理需求不明确

**实现完整度**：80%
- 后端架构完整
- 前端UI基本完整
- 缺少关键的数据关联功能

**可用性**：40%
- 虽然功能已实现，但由于分组和数据源无法关联，用户无法完成核心任务

## 改进建议

### 立即修复（高优先级）
1. 修复分组与数据源的关联功能
   - 在分组编辑Modal中添加数据源管理
   - 支持添加现有数据源到分组
   - 支持在分组中直接创建新数据源

### 需要澄清
1. 与用户确认分阶段AI处理的具体需求
2. 确认是否需要为每个分组配置多个AI配置

### 后续优化
1. 添加分组级别的数据统计和监控
2. 支持数据源的拖拽排序
3. 添加分组的使用指南和示例

## 下一步行动

1. **立即修复**：分组与数据源关联功能
2. **撰写代码评审文档**
3. **撰写changelog**
4. **编写测试用例**
5. **进行自测**
6. **与用户确认**：分阶段AI处理的具体需求
